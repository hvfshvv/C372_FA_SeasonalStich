<!DOCTYPE html>
<html>
<head>
    <title>StitchyBank - Seasonal Stitch</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <nav class="navbar">
        <a href="/" class="brand">Seasonal Stitch</a>
        <div class="nav-links">
            <% if (user && user.role === 'admin') { %>
                <a class="<%= activePage === 'dashboard' ? 'active' : '' %>" href="/admin/dashboard">Dashboard</a>
                <a class="<%= activePage === 'orders' ? 'active' : '' %>" href="/admin/orders">Orders</a>
                <a class="<%= activePage === 'inventory' ? 'active' : '' %>" href="/inventory">Inventory</a>
                <a class="<%= activePage === 'users' ? 'active' : '' %>" href="/admin/users">Users</a>
                <a class="<%= activePage === 'reports' ? 'active' : '' %>" href="/admin/reports">Reports</a>
                <a class="nav-pill" href="/stitchybank">Stitches: <%= stitchesBalance || 0 %></a>
                <span class="nav-welcome center">Welcome, <%= user.full_name %></span>
                <a href="/logout">Logout</a>
            <% } else if (user) { %>
                <a class="<%= activePage === 'shop' ? 'active' : '' %>" href="/#shop">Shop</a>
                <a class="<%= activePage === 'cart' ? 'active' : '' %>" href="/cart">Cart (<%= cartCount %>)</a>
                <a class="<%= activePage === 'orders' ? 'active' : '' %>" href="/orders">
                    Orders
                    <% if (reviewableCount && reviewableCount > 0) { %>
                        <span class="nav-badge"><%= reviewableCount %></span>
                    <% } %>
                </a>
                <a class="nav-pill" href="/stitchybank">Stitches: <%= stitchesBalance || 0 %></a>
                <span class="nav-pill secondary">Profile</span>
                <span class="nav-welcome center">Welcome, <%= user.full_name %></span>
                <a href="/logout">Logout</a>
            <% } else { %>
                <a href="/#hero">Home</a>
                <a href="/#shop">Shop</a>
                <a href="/login">Login</a>
                <a href="/register">Register</a>
            <% } %>
        </div>
    </nav>

    <div class="container">
        <div class="admin-header">
            <h2>StitchyBank</h2>
            <a href="/orders" class="btn btn-outline">View Orders</a>
        </div>

        <% if (message) { %>
            <div class="<%= message.type === 'error' ? 'error-message' : 'empty-state' %>"><%= message.text %></div>
        <% } %>

        <div class="form-container form-wide">
            <h3>Current Balance</h3>
            <p>You have <strong><%= stitchesBalance || 0 %></strong> Stitches available.</p>
        </div>

        <div class="form-container form-wide">
            <h3>Past Orders</h3>
            <% if (!orders || orders.length === 0) { %>
                <p class="order-muted">No orders found yet.</p>
            <% } else { %>
                <div class="table-wrap">
                    <table class="recent-orders-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Total</th>
                                <th>Stitches Earned</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% orders.forEach(order => { %>
                                <tr>
                                    <td>#<%= order.order_id %></td>
                                    <td><%= new Date(order.created_at).toLocaleDateString() %></td>
                                    <td>$<%= Number(order.total).toFixed(2) %></td>
                                    <td><%= Number(order.stitches_earned || 0) %></td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            <% } %>
        </div>

        <div class="form-container form-wide">
            <h3>Redeem Rewards</h3>
            <div class="orders-grid">
                <% rewards.forEach(reward => { %>
                    <div class="order-card">
                        <div>
                            <p class="order-label">Reward</p>
                            <h3><%= reward.name %></h3>
                            <p class="order-muted"><strong><%= reward.stitches %></strong> Stitches</p>
                            <p class="order-muted">Min spend $<%= reward.minSpend %></p>
                        </div>
                        <form action="/stitchybank/redeem" method="post">
                            <input type="hidden" name="rewardId" value="<%= reward.id %>">
                            <button type="submit" class="btn btn-primary btn-full">Redeem</button>
                        </form>
                    </div>
                <% }); %>
            </div>
        </div>
    </div>
    <%- include('partials/footer') %>
</body>
</html>
